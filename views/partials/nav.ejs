<!-- Sidebar Toggle Button (Visible only on small screens) -->
<button class="sidebar-toggle lg:hidden fixed top-[2vh] left-[1vw] z-[101] bg-white text-green-700 shadow-md rounded-xl cursor-pointer flex justify-center items-center h-[50px] w-[50px]">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7" />
    </svg>
</button>

<!--
  Sidebar Container:
  - Changed to fixed positioning for consistent behavior.
  - Added max-height and overflow for scrollability.
-->
<div class="sidebars hidden lg:flex fixed lg:top-[2vh] lg:left-[1vw] z-[100] flex-col lg:gap-[1vh] lg:max-h-[calc(100vh-4vh)] overflow-y-auto overflow-x-hidden">

    <!-- Main Sidebar -->
    <div class="sidebar w-[12vw] max-w-[300px] bg-white rounded-[15px] py-[1vw] px-0 shadow-md flex flex-col items-center">
        <img src="/img/GFMLogo.png" alt="GFM Logo" class="logo block my-[1vh] mx-auto w-3/5 h-auto rounded-[10px]">
        <h1 class="title text-center text-green-700 text-[0.9em] my-[5px] font-medium hidden lg:block">95.9 GREEN FM</h1>
        <ul class="menu list-none p-0 my-[5px] w-full">
            <li class="text-center my-[3px]">
                <!-- Check if currentPath matches '/' and apply active styles -->
                <a href="/" class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                    <% if (typeof currentPath !== 'undefined' && currentPath === '/') { %>
                        bg-green-700 text-white scale-105 /* Active state */
                    <% } else { %>
                        text-gray-800 /* Default state */
                    <% } %>
                ">
                    <i class="fas fa-house text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i>
                    <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">HOME</span>
                </a>
            </li>
            <li class="text-center my-[3px]">
                <!-- Check if currentPath matches '/Live' -->
                <a href="/Live" class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                    <% if (typeof currentPath !== 'undefined' && currentPath === '/Live') { %>
                        bg-green-700 text-white scale-105
                    <% } else { %>
                        text-gray-800
                    <% } %>
                ">
                    <i class="fas fa-video text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i>
                    <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">LIVE</span>
                </a>
            </li>
            <li class="text-center my-[3px]">
                <!-- Check if currentPath matches '/Forum' -->
                <a href="/Forum" class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                    <% if (typeof currentPath !== 'undefined' && currentPath === '/Forum') { %>
                        bg-green-700 text-white scale-105
                    <% } else { %>
                        text-gray-800
                    <% } %>
                ">
                    <i class="fas fa-comments text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i>
                    <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">FORUM</span>
                </a>
            </li>

            <li class="text-center my-[3px]">
                <!-- Check if currentPath matches '/Archives' -->
                <a href="/Archives" class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                    <% if (typeof currentPath !== 'undefined' && currentPath === '/Archives') { %>
                        bg-green-700 text-white scale-105 /* Active state */
                    <% } else { %>
                        text-gray-800 /* Default state */
                    <% } %>
                ">
                    <i class="fas fa-box-archive text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i> <!-- Archive icon -->
                    <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">ARCHIVES</span>
                </a>
            </li>
            
            <li class="text-center my-[3px]">
                <!-- Check if currentPath matches '/Playlist' -->
                <a href="/Playlist" class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                    <% if (typeof currentPath !== 'undefined' && currentPath === '/Playlist') { %>
                        bg-green-700 text-white scale-105
                    <% } else { %>
                        text-gray-800
                    <% } %>
                ">
                    <i class="fas fa-music text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i>
                    <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">PLAYLIST</span>
                </a>
            </li>
            
        </ul>
    </div>

    <!-- Sidebar 1 (Admin/User Specific Links) -->
    <div class="sidebar1 w-[12vw] max-w-[300px] bg-white rounded-[15px] py-[1vw] px-0 shadow-md flex flex-col items-center">
        <ul class="menu list-none p-0 my-[5px] w-full">
            <% if (user && (user.roles.includes('Admin') || user.roles.includes('Staff'))) { %>
                <li class="text-center my-[3px]">
                    <!-- Check if currentPath matches '/Manage-Accounts' -->
                    <a href="/Manage-Accounts" class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                        <% if (typeof currentPath !== 'undefined' && currentPath === '/Manage-Accounts') { %>
                            bg-green-700 text-white scale-105
                        <% } else { %>
                            text-gray-800
                        <% } %>
                    ">
                        <i class="fas fa-gear text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i>
                        <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">MANAGE <br class="hidden lg:inline">ACCOUNTS</span>
                    </a>
                </li>
                <li class="text-center my-[3px]">
                     <!-- Check if currentPath matches '/Blocktimer' -->
                    <a href="/Blocktimer" class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                        <% if (typeof currentPath !== 'undefined' && currentPath === '/Blocktimer') { %>
                            bg-green-700 text-white scale-105
                        <% } else { %>
                            text-gray-800
                        <% } %>
                    ">
                        <i class="fas fa-microphone text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i>
                        <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">BLOCKTIMER</span>
                    </a>
                </li>
                <li class="text-center my-[3px]">
                     <!-- Check if currentPath matches '/Staff' -->
                    <a href="/Staff" class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                        <% if (typeof currentPath !== 'undefined' && currentPath === '/Staff') { %>
                            bg-green-700 text-white scale-105
                        <% } else { %>
                            text-gray-800
                        <% } %>
                    ">
                        <i class="fas fa-user text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i>
                        <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">STAFF</span>
                    </a>
                </li>
            <% } else { %>
                <li class="text-center my-[3px]">
                    <% let blocktimerLink = user ? (user.completedBlocktimerStep1 ? (user.completedBlocktimerStep2 ? '/JoinBlocktimer-Step3' : '/JoinBlocktimer-Step2') : '/JoinBlocktimer-Step1') : '/LogIn?redirect=/JoinBlocktimer'; %>
                    <!-- Check if currentPath starts with '/JoinBlocktimer' -->
                    <a href="<%= blocktimerLink %>" id="joingreenfm-link" class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                        <% if (typeof currentPath !== 'undefined' && currentPath.startsWith('/JoinBlocktimer')) { %>
                            bg-green-700 text-white scale-105
                        <% } else { %>
                            text-gray-800
                        <% } %>
                    ">
                        <i class="fas fa-microphone text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i>
                        <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">BE A BLOCKTIMER</span>
                    </a>
                </li>
                <li class="text-center my-[3px]">
                    <% let joinGFMLink = user ? (user.completedJoinGFMStep1 ? (user.completedJoinGFMStep2 ? '/JoinGFM-Step3' : '/JoinGFM-Step2') : '/JoinGFM-Step1') : '/LogIn?redirect=/JoinGFM'; %>
                     <!-- Check if currentPath starts with '/JoinGFM' -->
                    <a href="<%= joinGFMLink %>" id="joingreenfm-link" data-restricted class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                        <% if (typeof currentPath !== 'undefined' && currentPath.startsWith('/JoinGFM')) { %>
                            bg-green-700 text-white scale-105
                        <% } else { %>
                            text-gray-800
                        <% } %>
                    ">
                        <i class="fas fa-user-plus text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i>
                        <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">JOIN<br class="hidden lg:inline">GREEN FM</span>
                    </a>
                </li>
            <% } %>
        </ul>
    </div>

    <!-- Sidebar 2 (About/Contact/Socials) -->
    <div class="sidebar2 w-[12vw] max-w-[300px] bg-white rounded-[15px] py-[1vw] px-0 shadow-md flex flex-col items-center">
        <ul class="menu list-none p-0 my-[5px] w-full">
            <li class="text-center my-[3px]">
                 <!-- Check if currentPath matches '/About' -->
                <a href="/About" class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                    <% if (typeof currentPath !== 'undefined' && currentPath === '/About') { %>
                        bg-green-700 text-white scale-105
                    <% } else { %>
                        text-gray-800
                    <% } %>
                ">
                    <i class="fas fa-circle-info text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i>
                    <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">ABOUT US</span>
                </a>
            </li>
            <li class="text-center my-[3px]">
                 <!-- Check if currentPath matches '/Contact' -->
                <a href="/Contact" class="flex items-center justify-center decoration-none font-medium py-[10px] px-[20px] transition-colors duration-300 box-border overflow-hidden whitespace-nowrap hover:text-white hover:bg-green-700 hover:scale-105 transform
                    <% if (typeof currentPath !== 'undefined' && currentPath === '/Contact') { %>
                        bg-green-700 text-white scale-105
                    <% } else { %>
                        text-gray-800
                    <% } %>
                ">
                    <i class="fas fa-phone text-lg md:text-xl inline-block flex-shrink-0 lg:hidden"></i>
                    <span class="hidden lg:inline lg:text-[11px] 2xl:text-[0.9em]">CONTACT US</span>
                </a>
            </li>
        </ul>
        <div class="social-icons hidden lg:flex justify-center mt-[1vh]">
            <a href="https://www.facebook.com/959GreenFm" target="_blank"><img src="/img/FBLogo.png" alt="Facebook" class="social-icon w-[22px] h-auto mx-2"></a>
            <a href="https://www.instagram.com/dlsud.greenfm/" target="_blank"><img src="/img/IGLogo.png" alt="Instagram" class="social-icon w-[22px] h-auto mx-2"></a>
        </div>
    </div>
</div>

<!-- JavaScript to toggle the sidebar -->
<style>
    /* Ensure toggle button is above sidebar when active */
    .sidebar-toggle {
        z-index: 101; /* Higher than .sidebars */
    }

    /* Style for when sidebar is open on mobile */
    .mobile-sidebar-open {
        /* Removed padding-top */
        height: 100vh;     /* Full viewport height */
        width: 30vw;      /* Reduced width */
        max-width: 210px; /* Reduced max-width */
        background-color: white; /* Give the container a background */
        flex-direction: column; /* Stack sidebars vertically */
        gap: 0; /* Remove gap between sidebars when stacked */
        /* Ensure it's displayed when class is added */
        display: flex !important;
        /* Add transition for smooth opening */
        transition: transform 0.3s ease-in-out;
        transform: translateX(0);
        /* Position it fixed to stay in place */
        position: fixed;
        left: 0;
        top: 0; /* Align to top */
        overflow-y: auto; /* Enable vertical scrolling */
        overflow-x: hidden; /* Prevent horizontal scrolling */
        z-index: 100; /* Ensure it's above most content */
        /* Remove lg: specific styles inherited from base .sidebars */
        max-height: none !important; /* Override lg:max-h */
    }

    /* Style for when sidebar is hidden on mobile (for transition) */
    .sidebars.hidden:not(.lg\:flex) {
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
    }

    /* Style adjustments for children within mobile open state */
    .mobile-sidebar-open .sidebar,
    .mobile-sidebar-open .sidebar1,
    .mobile-sidebar-open .sidebar2,
    .mobile-sidebar-open .user-section {
        width: 100%; /* Take full width of the container */
        max-width: none; /* Remove max-width */
        border-radius: 0; /* Optional: remove rounding */
        box-shadow: none; /* Optional: remove individual shadows */
        padding: 1vh 0; /* Adjust vertical padding */
        /* Ensure these elements don't shrink */
        flex-shrink: 0;
    }
    
    /* Add a separator line between stacked sidebars */
    .mobile-sidebar-open > div:not(:last-child) {
        border-bottom: 1px solid #eee;
    }

    /* Adjust logo position within the padded container */
    .mobile-sidebar-open .sidebar .logo {
         width: 50%; /* Example: Adjust size */
         margin-top: 2vh; /* Add some top margin */
         margin-bottom: 1vh;
    }

    /* Show text, hide icons, adjust layout for mobile (Base mobile styles) */
    .mobile-sidebar-open .title {
        display: block !important; /* Show title */
        font-size: 0.8em !important;
    }
    .mobile-sidebar-open .menu span {
        display: inline !important; /* Show menu text */
        font-size: 0.8em !important;
    }
    .mobile-sidebar-open .menu i {
         display: none !important; /* Hide icons by default in mobile view */
    }
    .mobile-sidebar-open .menu a {
        justify-content: flex-start !important; /* Align text left */
        padding-left: 15px !important;
        padding-right: 15px !important;
    }
    .mobile-sidebar-open .social-icons {
        display: flex !important; /* Show social icons */
        padding-bottom: 1vh;
    }
    
    /* Ensure Manage Account/Logout are hidden */
    .mobile-sidebar-open .user-section .hidden.lg\:block {
        display: none !important;
    }

    /* Media Query for screens between 376px and 425px */
    @media (min-width: 376px) and (max-width: 425px) {
        /* This query only adjusts font size, inherits icon/text display from base */
        .mobile-sidebar-open .title {
            font-size: 0.7em !important; /* Smaller title text */
        }
        .mobile-sidebar-open .menu span {
            font-size: 0.7em !important; /* Smaller menu text */
        }
    }

    /* Media Query for very small screens (e.g., 375px width or less) */
    @media (max-width: 375px) { /* Overrides base to show icons */
        .mobile-sidebar-open {
            width: 18vw; /* Further reduce width */
            max-width: 70px; /* Max width suitable for icons */
        }

        .mobile-sidebar-open .sidebar .logo {
            width: 80%; /* Adjust logo size if needed */
            margin-top: 1.5vh;
        }

        .mobile-sidebar-open .title {
            display: none !important; /* Hide title */
        }

        .mobile-sidebar-open .menu span {
            display: none !important; /* Hide menu text */
        }

        .mobile-sidebar-open .menu i {
            display: inline-block !important; /* Show icons */
            font-size: 1.1em !important; /* Adjust icon size if needed */
        }

        .mobile-sidebar-open .menu a {
            justify-content: center !important; /* Center the icon */
            padding-left: 5px !important;  /* Adjust padding */
            padding-right: 5px !important;
        }

        .mobile-sidebar-open .social-icons {
            display: none !important; /* Hide social icons */
        }
    }

</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggleButton = document.querySelector('.sidebar-toggle');
        const sidebarsContainer = document.querySelector('.sidebars');

        if (toggleButton && sidebarsContainer) {
            toggleButton.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent click from immediately closing sidebar via document listener
                const isOpen = !sidebarsContainer.classList.contains('hidden');

                if (isOpen && window.innerWidth < 1024) { // Only applies to mobile view closing
                    // Closing sidebar on mobile
                    sidebarsContainer.classList.add('hidden'); // Hide it first for transition
                    sidebarsContainer.classList.remove('mobile-sidebar-open'); // Remove mobile class
                    // We don't need to manage 'flex' here as 'hidden' takes precedence
                } else if (!isOpen && window.innerWidth < 1024) {
                     // Opening sidebar on mobile
                    sidebarsContainer.classList.remove('hidden'); // Make it visible
                    sidebarsContainer.classList.add('mobile-sidebar-open'); // Add mobile styles
                    // 'display: flex !important' in mobile-sidebar-open handles display
                }
                // Note: On large screens (>= 1024px), the button is hidden, so this click handler
                // effectively only controls the mobile sidebar state. The lg:flex class handles
                // visibility on large screens based on the presence/absence of 'hidden'.
            });

            // Close sidebar if clicking outside of it on smaller screens
            document.addEventListener('click', (event) => {
                const isClickInsideSidebar = sidebarsContainer.contains(event.target);
                const isClickOnToggleButton = toggleButton.contains(event.target);
                const isSmallScreen = window.innerWidth < 1024; // lg breakpoint
                // Check if mobile sidebar is open by checking for the class
                const isMobileOpen = sidebarsContainer.classList.contains('mobile-sidebar-open');

                // If mobile sidebar is open and click is outside
                if (isMobileOpen && isSmallScreen && !isClickInsideSidebar && !isClickOnToggleButton) {
                    sidebarsContainer.classList.add('hidden'); // Hide for transition
                    sidebarsContainer.classList.remove('mobile-sidebar-open'); // Remove mobile class
                }
            });

            // Handle resize to adjust classes
            window.addEventListener('resize', () => {
                const isSmallScreen = window.innerWidth < 1024;
                const isMobileOpen = sidebarsContainer.classList.contains('mobile-sidebar-open');

                if (!isSmallScreen) {
                    // Resized to Large Screen
                    // If mobile sidebar was open, remove its class.
                    // Ensure 'hidden' is also removed so lg:flex can show it.
                    if (isMobileOpen) {
                        sidebarsContainer.classList.remove('mobile-sidebar-open');
                    }
                    // Always ensure 'hidden' is removed on large screens so lg:flex applies
                    sidebarsContainer.classList.remove('hidden');

                } else {
                    // Resized to Small Screen
                    // If the mobile sidebar was open OR if it was visible due to large screen view
                    // force it back to the default hidden state for small screens.
                    // The user will need to toggle it again if they want it open.
                    if (isMobileOpen || !sidebarsContainer.classList.contains('hidden')) {
                         sidebarsContainer.classList.remove('mobile-sidebar-open'); // Ensure mobile class is removed
                         sidebarsContainer.classList.add('hidden'); // Ensure it's hidden by default on small screens
                    }
                    // If it was already hidden and mobile-sidebar-open wasn't present, do nothing.
                }
            });

            // Initial check on load
             if (window.innerWidth < 1024) {
                 if (!sidebarsContainer.classList.contains('mobile-sidebar-open')) {
                    sidebarsContainer.classList.add('hidden');
                 }
             } else {
                 sidebarsContainer.classList.remove('mobile-sidebar-open');
                 // No need to remove 'hidden' here on load, lg:flex handles visibility if not hidden
             }


        } else {
            console.error("Sidebar toggle button or container not found.");
        }
    });
</script>
<!-- Link to restrictedLinks.js (ensure path is correct) -->
<script src="/js/restrictedLinks.js"></script>